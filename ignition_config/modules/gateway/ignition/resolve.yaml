---
variant: fcos
version: 1.4.0
storage:
  files:
    %{~ for _, interface in interfaces ~}
    %{~ if lookup(interface, "enable_gateway", false) ~}
    - path: /etc/systemd/network/20-${interface.interface_name}.network.d/10-upstream-dns.conf
      mode: 0644
      contents:
        inline: |
          [Network]
          DNS=${upstream_dns_ip}#${upstream_dns_tls_servername}
          DNSOverTLS=true
          DNSDefaultRoute=true
    %{~ endif ~}
    %{~ endfor ~}