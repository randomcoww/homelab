apiVersion: v1
kind: Secret
metadata:
  name: {{ template "mpd.fullname" . }}
  labels:
    app: {{ template "mpd.name" . }}
    chart: {{ template "mpd.chart" . }}
    release: {{ .Release.Name }}
stringData:
  mpd.conf: |
    bind_to_address "127.0.0.1"
    port "{{ .Values.ports.mpdControl }}"
    music_directory "http://127.0.0.1:{{ .Values.ports.rclone }}/"
    playlist_directory "{{ .Values.mpdCachePath }}/playlists"
    db_file "{{ .Values.mpdCachePath }}/tag_cache"
    state_file "{{ .Values.mpdCachePath }}/state"
    sticker_file "{{ .Values.mpdCachePath }}/sticker.sql"
{{- range $k, $v := .Values.config }}
    {{ $k }} "{{ $v }}"
{{- end }}
{{- range $audioOutput := .Values.audioOutputs }}
    audio_output {
      type "httpd"
      name "{{ $audioOutput.name }}"
      port "{{ $audioOutput.port }}"
      bind_to_address "0.0.0.0"
{{- range $k, $v := $audioOutput.config }}
      {{ $k }} "{{ $v }}"
{{- end }}
    }
{{- end }}