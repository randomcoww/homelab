---
variant: fcos
version: 1.4.0
systemd:
  units:
    - name: geoclue.service
      enabled: true
    - name: default-dconf-update.service
      enabled: true
      contents: |
        [Unit]
        ConditionFirstBoot=true
        ConditionDirectoryNotEmpty=/etc/dconf/db/local.d/

        [Service]
        Type=oneshot
        RemainAfterExit=true
        ExecStart=/usr/bin/dconf update

        [Install]
        WantedBy=graphical.target

storage:
  files:
    # controller support in steam flatpak
    - path: /etc/udev/rules.d/62-steam-input.rules
      mode: 0644
      contents:
        inline: |
          ${indent(10, udev_steam_input)}
    - path: /etc/udev/rules.d/62-steam-vr.rules
      mode: 0644
      contents:
        inline: |
          ${indent(10, udev_steam_vr)}

    # firefox
    - path: /etc/firefox/pref/autoconfig.js
      mode: 0644
      contents:
        inline: |
          pref("general.config.filename", "mozilla.cfg");
          pref("general.config.obscure_value", 0);
    - path: /etc/firefox/pref/mozilla.cfg
      mode: 0644
      contents:
        inline: |
          //
          // startup
          pref("browser.startup.homepage", "about:blank");
          pref("browser.startup.page", 3);
          pref("browser.aboutConfig.showWarning", false);
          pref("browser.tabs.warnOnClose", false);
          pref("browser.tabs.warnOnCloseOtherTabs", false);
          pref("browser.tabs.warnOnOpen", false);
          pref("browser.warnOnQuit", false);
          // nuke bookmarks (works after first run)
          lockPref("browser.toolbars.bookmarks.visibility", "never");
          // local sync
          pref("services.sync.engine.passwords", false);
          pref("services.sync.syncInterval", 30000);
          // disable as much disk cache as possible
          pref("browser.cache.disk.enable", false);
          pref("browser.cache.disk.smart_size.enabled", false);
          pref("browser.cache.disk_cache_ssl", false);
          pref("browser.cache.offline.enable", false);
          pref("browser.sessionstore.interval", 300000);
          pref("browser.cache.memory.enable", true);
          pref("browser.cache.memory.capacity", -1);
          pref("browser.cache.memory.max_entry_size", 51200);
          // performance
          // pref("layers.acceleration.force-enabled", true);
          // pref("gfx.webrender.all", true);
          // pref("gfx.webrender.enabled", true);
          pref("widget.wayland-dmabuf-vaapi.enabled", true);
          // privacy (https://github.com/arkenfox/user.js/blob/master/user.js)
          pref("browser.safebrowsing.downloads.remote.enabled", false);
          pref("browser.safebrowsing.malware.enabled", false);
          pref("browser.safebrowsing.phishing.enabled", false);
          pref("extensions.pocket.enabled", false);
          pref("privacy.resistFingerprinting", true);
          pref("privacy.trackingprotection.enabled", true);
          pref("toolkit.telemetry.unified", false);
          pref("toolkit.telemetry.enabled", false);
          pref("toolkit.telemetry.archive.enabled", false);
          pref("toolkit.telemetry.newProfilePing.enabled", false);
          pref("toolkit.telemetry.shutdownPingSender.enabled", false);
          pref("toolkit.telemetry.updatePing.enabled", false);
          pref("toolkit.telemetry.bhrPing.enabled", false);
          pref("toolkit.telemetry.firstShutdownPing.enabled", false);
          pref("toolkit.telemetry.coverage.opt-out", true);
          pref("toolkit.coverage.opt-out", true);
          pref("network.trr.mode", 0);
          pref("signon.rememberSignons", false);

    # gnome desktop config #
    - path: /etc/dconf/db/local.d/00-custom
      mode: 0644
      contents:
        inline: |
          [org/gnome/system/location]
          enabled=false

          [org/gnome/desktop/datetime]
          automatic-timezone=true

          [org/gnome/settings-daemon/plugins/color]
          night-light-enabled=true
          night-light-schedule-automatic=true

          [org/gnome/settings-daemon/plugins/power]
          ambient-enabled=false
          idle-dim=false

          [org/gnome/desktop/media-handling]
          automount=false
          autorun-never=true

          [org/gnome/desktop/sound]
          event-sounds=false

          [org/gnome/desktop/session]
          idle-delay=uint32 3600

          [org/gnome/desktop/peripherals/touchpad]
          tap-to-click=true
          two-finger-scrolling-enabled=true

          [org/gnome/desktop/privacy]
          disable-camera=true
          disable-microphone=true
          old-files-age=uint32 1
          remember-recent-files=false
          remove-old-temp-files=true
          remove-old-trash-files=true
          report-technical-problems=false

          [org/gnome/software]
          first-run=false
          show-nonfree-prompt=false

          [org/gnome/desktop/notifications]
          show-in-lock-screen=false

          [org/gnome/desktop/interface]
          enable-hot-corners=false

          [org/gnome/system/location]
          enabled=true

    # misc configs #
    - path: /etc/tmux.conf
      mode: 0644
      contents:
        inline: |
          set -g history-limit 10000
          set -g mouse on
          set-option -s set-clipboard off
          bind-key -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "xclip -in -sel clip"
    - path: /etc/mpv/mpv.conf
      mode: 0644
      contents:
        inline: |
          profile=gpu-hq
          hwdec=vaapi

    # ssh-ca client #
    - path: /etc/ssh/ssh_known_hosts
      mode: 0644
      contents:
        inline: "@cert-authority * ${ssh_ca_authorized_key}"