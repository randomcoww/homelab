install
reboot
url --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=fedora-$releasever&arch=$basearch
repo --name=fedora-updates --mirrorlist=http://mirrors.fedoraproject.org/mirrorlist?repo=updates-released-f$releasever&arch=$basearch
repo --name=rpmfusion-free --metalink=https://mirrors.rpmfusion.org/metalink?repo=free-fedora-$releasever&arch=$basearch
repo --name=rpmfusion-free-updates --metalink=https://mirrors.rpmfusion.org/metalink?repo=free-fedora-updates-released-$releasever&arch=$basearch
repo --name=rpmfusion-nonfree --metalink=https://mirrors.rpmfusion.org/metalink?repo=nonfree-fedora-$releasever&arch=$basearch
repo --name=rpmfusion-nonfree-updates --metalink=https://mirrors.rpmfusion.org/metalink?repo=nonfree-fedora-updates-released-$releasever&arch=$basearch
#repo --name=docker-ce --baseurl=https://download.docker.com/linux/fedora/$releasever/$basearch/stable
repo --name=kubernetes --baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-$basearch
repo --name=code --baseurl=https://packages.microsoft.com/yumrepos/vscode

lang en_US.UTF-8
keyboard us
timezone --utc America/Los_Angeles
rootpw --lock password
firewall --disabled
network --hostname={{.hostname}}

## disk
zerombr
clearpart --all --initlabel --disklabel=gpt
autopart --type=plain --noswap --nohome
bootloader --timeout=1 --append="elevator=noop"

## packages
%packages --excludeWeakdeps --excludedocs
@core
@workstation-product
@firefox
@fonts
@gnome-desktop
@hardware-support
@multimedia
@printing
@base-x
@networkmanager-submodules

ksm
ipmitool
dnf-automatic
cronie
screen
lm_sensors
vim-enhanced
tilix
libva-intel-driver
#docker-ce
kubectl
code

%end

## user
user --name={{.default_user}} --password={{.password}} --plaintext --groups=wheel,libvirt,docker


##
## post config
##

%post --erroronfail


##
## general file writes
##

cat <<EOF > /etc/dnf/automatic.conf
[commands]
apply_updates=True
upgrade_type=security

[emitters]
emit_via=motd
EOF


##
## enable services
##

systemctl enable \
  chronyd crond \
  ksm ksmtuned \
  docker \
  dnf-automatic.timer

systemctl set-default graphical.target

##
## cleanup
##

dnf -y autoremove
dnf -y clean all

%end
