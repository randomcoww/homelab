# TODO: remove
---
variant: fcos
version: ${ignition_version}
systemd:
  units:
    # Special case share over double NAT LAN
    - name: nftables@sunshine.service
      enabled: true

storage:
  files:
    # Special case share over double NAT LAN
    - path: /etc/nftables/sunshine.nft
      mode: 0644
      overwrite: true
      contents:
        inline: |
          table ip sunshine {
            chain base-checks {
              ct state {established, related} accept;
              ct state invalid drop;
              ip protocol icmp icmp type { echo-request, echo-reply, time-exceeded, parameter-problem, destination-unreachable } accept;
            }
            chain input {
              type filter hook input priority filter + 2; policy accept;
              jump base-checks;
              iifname ${external_interface_name} pkttype multicast accept;
              iifname ${external_interface_name} tcp dport 47984-47990 accept;
              iifname ${external_interface_name} tcp dport 48010 accept;
              iifname ${external_interface_name} udp dport 47998-48000 accept;
              iifname ${external_interface_name} drop;
            }
            chain forward {
              type filter hook forward priority filter + 2; policy accept;
              jump base-checks;
              iifname ${external_interface_name} drop;
            }
          }
          ;